## Q:连接池的作用？

- **资源重用和更快的响应速度**。将已经创建好的连接保存在池中，当有请求来时，直接使用已经创建好的连接对Server端进行访问。省去了**创建连接和销毁连接的过程(TCP连接建立时的三次握手和四次挥手)** 。
- 统一管理避免连接泄露。

## Q:设计连接池需要考虑的问题

- 线程安全（并发安全）：多线程访问时，采用了加锁机制，当一个线程访问该类的某个数据时，进行保护，其他线程不能进行访问直到该线程读取完，其他线程才可使用。不会出现数据不一致或者数据污染。

### 整体结构

- 连接池对外提供接口：获得连接、归还连接、配置最小空闲连接数和最大连接数等客户端配置的参数
- 内部需要实现：连接建立、连接心跳保持、连接管理、空闲连接回收、连接可用性检测

### 基本原理

- 建立连接池对象。`go/src/database/sql/sql.go:OpenDB`。
- 初始化连接池参数，设置空闲连接数等。
- **对于一个访问请求，直接从连接池中得到一个连接。如果连接池对象中没有空闲的连接，且连接数没有达到最大（即：最大活跃连接数），创建一个新的连接；如果达到最大，则设定一定的超时时间，来获取连接。**
- 使用连接访问服务。
- 访问服务完成，释放连接（此时的释放连接，并非真正关闭，而是将其放入空闲队列中。如实际空闲连接数大于初始空闲连接数则释放连接）。
- 释放连接池对象（服务停止、维护期间，释放连接池对象，并释放所有连接）。



## Q:数据库连接数设置多少比较合理？

- 连接数  = 数据库核心数*2+有效磁盘数。
- 连接数设置参考信息：CPU、磁盘、网络。

 [数据库连接池应该设置多大](https://app.yinxiang.com/shard/s43/nl/13675070/1df7a792-ab4d-459d-800c-534621fd2182)

